version: 2.1

orbs:
  aws-cli: circleci/aws-cli@2.0.3
  aws-code-deploy: circleci/aws-code-deploy@3.0.0
  

jobs:
  codeDeploy:
    docker:
      - image: ubuntu-2004:2023.04.2
    steps:
      - checkout
      - aws-cli/setup:
          aws-secret-access-key: AWS_SECRET_ACCESS_KEY_ID
          aws-region: AWS_REGION 
          profile-name: b4rz
          aws-access-key-id: AWS_ACCESS_KEY_ID
      - run: |
            COMMIT_ID=$(curl -s https://api.github.com/repos/WMS-PF/WMS_LogixPro/commits/circleci-and-codedeploy-setup | jq -r '.sha')
            aws deploy create-deployment \
              --application-name github_dep \
              --deployment-group-name github_dep_group \
              --file-exists-behavior OVERWRITE \
              --deployment-config-name CodeDeployDefault.OneAtATime \
              --github-location repository=WMS-PF/WMS_LogixPro,commitId=$COMMIT_ID \
  codeDeploy2:
      docker:
        - image: ubuntu-2004:2023.04.2
      steps:
        - aws-cli/setup:
            aws-secret-access-key: AWS_SECRET_ACCESS_KEY_ID_1  
            aws-region: AWS_REGION 
            profile-name: andresF 
            aws-access-key-id: AWS_ACCESS_KEY_ID_1
        - run: |
            COMMIT_ID=$(curl -s https://api.github.com/repos/WMS-PF/WMS_LogixPro/commits/circleci-and-codedeploy-setup | jq -r '.sha')
            aws deploy create-deployment \
              --application-name Git_application \
              --deployment-group-name development_gropup \
              --file-exists-behavior OVERWRITE \
              --deployment-config-name CodeDeployDefault.OneAtATime \
              --github-location repository=WMS-PF/WMS_LogixPro,commitId=$COMMIT_ID
  codeDeploy3:
      docker:
        - image: ubuntu-2004:2023.04.2
      steps:
        - checkout
        - aws-cli/setup:
            profile-name: Juan Camargo
            aws-access-key-id: AWSJ_ACCESS_KEY_ID
            aws-secret-access-key: AWSJ_SECRET_ACCESS_KEY
        - run: |
            COMMIT_ID=$(curl -s https://api.github.com/repos/WMS-PF/WMS_LogixPro/commits/circleci-and-codedeploy-setup | jq -r '.sha')
            aws deploy create-deployment \
              --application-name github \
              --deployment-group-name github_auto \
              --file-exists-behavior OVERWRITE \
              --deployment-config-name CodeDeployDefault.OneAtATime \
              --github-location repository=WMS-PF/WMS_LogixPro,commitId=$COMMIT_ID
  codeDeploy4:
      docker:
        - image: ubuntu-2004:2023.04.2
      steps:
        - checkout
        - aws-cli/setup:
            profile-name: nayelio
            aws-access-key-id: AWSN_ACCESS_KEY_ID
            aws-secret-access-key: AWSN_SECRET_ACCESS_KEY
        - run: |
            COMMIT_ID=$(curl -s https://api.github.com/repos/WMS-PF/WMS_LogixPro/commits/circleci-and-codedeploy-setup | jq -r '.sha')
            aws deploy create-deployment \
              --application-name Nayeli_EC \
              --deployment-group-name EC2Nayeli_DG \
              --file-exists-behavior OVERWRITE \
              --deployment-config-name CodeDeployDefault.OneAtATime \
              --github-location repository=WMS-PF/WMS_LogixPro,commitId=$COMMIT_ID
    

workflows:
  EC2-Deploy:
    jobs:
      - codeDeploy
      - codeDeploy2
      - codeDeploy3
      - codeDeploy4